<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§è€äºŒ Â· ä¸‰äººç‰ˆ</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #1e4b2e, #2a6e3a);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 20px;
        }
        .game-container {
            max-width: 1000px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            border: 2px solid rgba(255,215,0,0.3);
        }
        h1 {
            text-align: center;
            color: gold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin: 0 0 20px 0;
            font-size: 2.5em;
            letter-spacing: 4px;
        }
        .players-area {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 15px;
        }
        .player-card {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 20px;
            padding: 15px;
            flex: 1;
            border: 2px solid #d4af37;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .player-card.active {
            border-color: #ff4444;
            box-shadow: 0 0 20px rgba(255,68,68,0.5);
            transform: scale(1.02);
        }
        .player-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #ffd700;
            display: flex;
            justify-content: space-between;
        }
        .player-hand {
            font-size: 1.1em;
            line-height: 1.8;
            min-height: 100px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 10px;
            font-family: 'Courier New', monospace;
        }
        .card-count {
            background: #ffd700;
            color: black;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.8em;
        }
        .center-area {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #d4af37;
        }
        .last-play {
            text-align: center;
            font-size: 1.5em;
            color: white;
            padding: 15px;
            background: rgba(255,215,0,0.1);
            border-radius: 15px;
            margin-bottom: 15px;
        }
        .last-play-cards {
            font-size: 2em;
            letter-spacing: 5px;
            color: #ffd700;
        }
        .message {
            text-align: center;
            color: white;
            font-size: 1.2em;
            margin: 10px 0;
            min-height: 30px;
        }
        .player-controls {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        .hand-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        .card {
            background: white;
            color: black;
            width: 60px;
            height: 90px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: all 0.2s;
            border: 2px solid #333;
            position: relative;
        }
        .card.selected {
            transform: translateY(-20px);
            border-color: #ff4444;
            box-shadow: 0 8px 16px rgba(255,68,68,0.4);
        }
        .card.red {
            color: #ff4444;
        }
        .card.black {
            color: #333;
        }
        .card-suit {
            font-size: 1.5em;
        }
        .card-rank {
            font-size: 1.2em;
        }
        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }
        button {
            padding: 12px 30px;
            font-size: 1.2em;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            background: #ffd700;
            color: #1e4b2e;
            border: 2px solid #b8860b;
        }
        button:hover {
            transform: scale(1.05);
            background: #ffed4a;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        button.secondary {
            background: #666;
            color: white;
            border-color: #333;
        }
        .game-over {
            text-align: center;
            font-size: 2em;
            color: gold;
            padding: 30px;
            background: rgba(0,0,0,0.8);
            border-radius: 20px;
            margin: 20px 0;
        }
        .new-game-btn {
            background: #4CAF50;
            color: white;
            font-size: 1.5em;
            padding: 15px 40px;
        }
    </style>
</head>
<body>
    <div class="game-container" id="gameContainer">
        <h1>â™  å¤§è€äºŒ â™¥</h1>
        
        <div class="players-area" id="playersArea"></div>
        
        <div class="center-area">
            <div class="last-play">
                <div>ä¸Šä¸€æ‰‹ç‰Œ</div>
                <div class="last-play-cards" id="lastPlayCards">-</div>
                <div id="lastPlayer" style="font-size: 1em; color: #aaa;"></div>
            </div>
            <div class="message" id="message">æ¸¸æˆå¼€å§‹ï¼</div>
        </div>
        
        <div class="player-controls" id="playerControls">
            <h3 style="color: white; text-align: center; margin: 0 0 10px 0;">ä½ çš„æ‰‹ç‰Œ</h3>
            <div class="hand-cards" id="playerHand"></div>
            <div class="buttons">
                <button onclick="playCards()">å‡ºç‰Œ</button>
                <button class="secondary" onclick="pass()">è¿‡ç‰Œ</button>
            </div>
        </div>
        
        <div id="gameOverScreen" style="display: none;"></div>
    </div>

    <script>
        // ç‰Œçš„å®šä¹‰
        const Suit = {
            CLUB: { name: 'CLUB', symbol: 'â™£', value: 1, color: 'black' },
            DIAMOND: { name: 'DIAMOND', symbol: 'â™¦', value: 2, color: 'red' },
            HEART: { name: 'HEART', symbol: 'â™¥', value: 3, color: 'red' },
            SPADE: { name: 'SPADE', symbol: 'â™ ', value: 4, color: 'black' }
        };
        
        const Rank = {
            THREE: { name: '3', value: 3 },
            FOUR: { name: '4', value: 4 },
            FIVE: { name: '5', value: 5 },
            SIX: { name: '6', value: 6 },
            SEVEN: { name: '7', value: 7 },
            EIGHT: { name: '8', value: 8 },
            NINE: { name: '9', value: 9 },
            TEN: { name: '10', value: 10 },
            JACK: { name: 'J', value: 11 },
            QUEEN: { name: 'Q', value: 12 },
            KING: { name: 'K', value: 13 },
            ACE: { name: 'A', value: 14 },
            TWO: { name: '2', value: 15 }
        };
        
        // æ¸¸æˆçŠ¶æ€
        let game = {
            players: [],
            currentPlayerIdx: 0,
            lastPlay: [],
            lastPlayerIdx: -1,
            firstTurn: true,
            passCount: 0,
            gameOver: false,
            winner: null,
            selectedCards: []
        };
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // åˆ›å»ºç©å®¶
            game.players = [
                { name: 'ä½ ', hand: [], isHuman: true, passed: false },
                { name: 'ç”µè„‘1', hand: [], isHuman: false, passed: false },
                { name: 'ç”µè„‘2', hand: [], isHuman: false, passed: false }
            ];
            
            // åˆ›å»ºç‰Œç»„
            let deck = [];
            for (let suit of Object.values(Suit)) {
                for (let rank of Object.values(Rank)) {
                    deck.push({ suit, rank });
                }
            }
            
            // æ´—ç‰Œ
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            
            // å‘ç‰Œ
            for (let i = 0; i < deck.length; i++) {
                const playerIdx = i % 3;
                game.players[playerIdx].hand.push(deck[i]);
            }
            
            // æ’åºæ‰‹ç‰Œ
            game.players.forEach(p => {
                p.hand.sort((a, b) => {
                    if (a.rank.value !== b.rank.value) return a.rank.value - b.rank.value;
                    return a.suit.value - b.suit.value;
                });
            });
            
            // æ‰¾åˆ°æŒæœ‰æ¢…èŠ±3çš„ç©å®¶
            for (let i = 0; i < game.players.length; i++) {
                const hasClubThree = game.players[i].hand.some(c => 
                    c.suit === Suit.CLUB && c.rank === Rank.THREE);
                if (hasClubThree) {
                    game.currentPlayerIdx = i;
                    break;
                }
            }
            
            game.lastPlay = [];
            game.lastPlayerIdx = -1;
            game.firstTurn = true;
            game.passCount = 0;
            game.gameOver = false;
            game.winner = null;
            game.selectedCards = [];
            
            updateUI();
            updateMessage(`æ¸¸æˆå¼€å§‹ï¼è½®åˆ° ${game.players[game.currentPlayerIdx].name} å‡ºç‰Œ`);
            
            // å¦‚æœæ˜¯ç”µè„‘å›åˆï¼Œè‡ªåŠ¨å‡ºç‰Œ
            if (!game.players[game.currentPlayerIdx].isHuman) {
                setTimeout(computerPlay, 1000);
            }
        }
        
        // æ›´æ–°UI
        function updateUI() {
            // æ›´æ–°ç©å®¶åŒºåŸŸ
            const playersArea = document.getElementById('playersArea');
            playersArea.innerHTML = '';
            
            game.players.forEach((player, idx) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = `player-card ${idx === game.currentPlayerIdx && !game.gameOver ? 'active' : ''}`;
                
                const handPreview = player.hand.map(c => {
                    const color = c.suit.color === 'red' ? 'red' : 'black';
                    return `<span style="color: ${color}">${c.suit.symbol}${c.rank.name}</span>`;
                }).join(' ');
                
                playerDiv.innerHTML = `
                    <div class="player-name">
                        ${player.name}
                        <span class="card-count">${player.hand.length}å¼ </span>
                    </div>
                    <div class="player-hand">
                        ${player.isHuman ? 'ï¼ˆä½ çš„æ‰‹ç‰Œåœ¨ä¸‹æ–¹ï¼‰' : handPreview || 'æ— ç‰Œ'}
                    </div>
                `;
                
                playersArea.appendChild(playerDiv);
            });
            
            // æ›´æ–°ä¸Šä¸€æ‰‹ç‰Œ
            const lastPlayDiv = document.getElementById('lastPlayCards');
            if (game.lastPlay.length > 0) {
                lastPlayDiv.innerHTML = game.lastPlay.map(c => 
                    `<span style="color: ${c.suit.color}">${c.suit.symbol}${c.rank.name}</span>`
                ).join(' ');
            } else {
                lastPlayDiv.innerHTML = '-';
            }
            
            document.getElementById('lastPlayer').innerHTML = 
                game.lastPlayerIdx >= 0 ? `ç”± ${game.players[game.lastPlayerIdx].name} å‡ºç‰Œ` : '';
            
            // æ›´æ–°ç©å®¶æ‰‹ç‰Œæ˜¾ç¤º
            if (!game.gameOver) {
                const playerHand = document.getElementById('playerHand');
                const player = game.players[0];
                
                playerHand.innerHTML = '';
                player.hand.forEach((card, idx) => {
                    const cardDiv = document.createElement('div');
                    cardDiv.className = `card ${card.suit.color} ${game.selectedCards.includes(idx) ? 'selected' : ''}`;
                    cardDiv.onclick = () => toggleCardSelection(idx);
                    cardDiv.innerHTML = `
                        <div class="card-suit">${card.suit.symbol}</div>
                        <div class="card-rank">${card.rank.name}</div>
                    `;
                    playerHand.appendChild(cardDiv);
                });
            }
            
            // æ£€æŸ¥æ¸¸æˆç»“æŸ
            checkGameOver();
        }
        
        // åˆ‡æ¢å¡ç‰Œé€‰æ‹©
        function toggleCardSelection(idx) {
            if (game.gameOver || game.currentPlayerIdx !== 0) return;
            
            const index = game.selectedCards.indexOf(idx);
            if (index === -1) {
                game.selectedCards.push(idx);
            } else {
                game.selectedCards.splice(index, 1);
            }
            
            // æ’åºé€‰ä¸­çš„å¡ç‰Œ
            game.selectedCards.sort((a, b) => a - b);
            updateUI();
        }
        
        // å‡ºç‰Œ
        function playCards() {
            if (game.gameOver || game.currentPlayerIdx !== 0) return;
            
            const player = game.players[0];
            const selectedCards = game.selectedCards.map(i => player.hand[i]);
            
            if (selectedCards.length === 0) {
                updateMessage('è¯·é€‰æ‹©è¦å‡ºçš„ç‰Œï¼');
                return;
            }
            
            if (!isValidPlay(selectedCards, player)) {
                updateMessage('æ— æ•ˆçš„å‡ºç‰Œï¼');
                return;
            }
            
            // æ‰§è¡Œå‡ºç‰Œ
            executePlay(0, selectedCards);
        }
        
        // è¿‡ç‰Œ
        function pass() {
            if (game.gameOver || game.currentPlayerIdx !== 0) return;
            
            // å¦‚æœæ˜¯ç¬¬ä¸€æ‰‹ï¼Œä¸èƒ½è¿‡ç‰Œ
            if (game.firstTurn) {
                updateMessage('ç¬¬ä¸€æ‰‹å¿…é¡»å‡ºç‰Œï¼');
                return;
            }
            
            // å¦‚æœè‡ªå·±æ˜¯ä¸Šä¸€è½®çš„å‡ºç‰Œè€…ï¼Œä¸èƒ½è¿‡ç‰Œ
            if (game.lastPlayerIdx === 0) {
                updateMessage('ä½ æ˜¯ä¸Šä¸€è½®çš„å‡ºç‰Œè€…ï¼Œå¿…é¡»å‡ºç‰Œï¼');
                return;
            }
            
            game.passCount++;
            game.currentPlayerIdx = (game.currentPlayerIdx + 1) % 3;
            game.selectedCards = [];
            
            updateUI();
            updateMessage(`${game.players[0].name} è¿‡ç‰Œ`);
            
            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰äººéƒ½è¿‡ç‰Œ
            if (game.passCount >= 2) {
                game.lastPlay = [];
                game.passCount = 0;
                updateMessage('æ‰€æœ‰äººè¿‡ç‰Œï¼Œæ–°çš„ä¸€è½®å¼€å§‹');
            }
            
            // ç”µè„‘å›åˆ
            if (!game.players[game.currentPlayerIdx].isHuman) {
                setTimeout(computerPlay, 1000);
            }
        }
        
        // ç”µè„‘å‡ºç‰Œ
        function computerPlay() {
            if (game.gameOver) return;
            
            const player = game.players[game.currentPlayerIdx];
            
            // å¦‚æœæ˜¯ç¬¬ä¸€æ‰‹ï¼Œå‡ºæ¢…èŠ±3
            if (game.firstTurn) {
                const clubThree = player.hand.find(c => 
                    c.suit === Suit.CLUB && c.rank === Rank.THREE);
                if (clubThree) {
                    executePlay(game.currentPlayerIdx, [clubThree]);
                }
                return;
            }
            
            // å°è¯•å‡ºç‰Œ
            let played = false;
            
            if (game.lastPlay.length === 0) {
                // æ–°çš„ä¸€è½®ï¼Œå‡ºæœ€å°çš„ç‰Œ
                executePlay(game.currentPlayerIdx, [player.hand[0]]);
                played = true;
            } else {
                // å°è¯•ç®¡ä¸Š
                const handType = getHandType(game.lastPlay);
                const possiblePlays = [];
                
                if (handType === 'single') {
                    // æ‰¾å•å¼ 
                    for (let card of player.hand) {
                        if (compareCards(card, game.lastPlay[0]) > 0) {
                            possiblePlays.push([card]);
                        }
                    }
                } else if (handType === 'pair') {
                    // æ‰¾å¯¹å­
                    for (let i = 0; i < player.hand.length - 1; i++) {
                        if (player.hand[i].rank === player.hand[i+1].rank) {
                            const pair = [player.hand[i], player.hand[i+1]];
                            if (compareHands(pair, game.lastPlay) > 0) {
                                possiblePlays.push(pair);
                            }
                        }
                    }
                }
                
                if (possiblePlays.length > 0) {
                    // å‡ºæœ€å°çš„èƒ½ç®¡ä¸Šçš„ç‰Œ
                    possiblePlays.sort((a, b) => compareHands(a, b));
                    executePlay(game.currentPlayerIdx, possiblePlays[0]);
                    played = true;
                }
            }
            
            if (!played) {
                // æ²¡æœ‰ç‰Œå¯å‡ºï¼Œè¿‡ç‰Œ
                game.passCount++;
                game.currentPlayerIdx = (game.currentPlayerIdx + 1) % 3;
                updateUI();
                updateMessage(`${player.name} è¿‡ç‰Œ`);
                
                if (game.passCount >= 2) {
                    game.lastPlay = [];
                    game.passCount = 0;
                    updateMessage('æ‰€æœ‰äººè¿‡ç‰Œï¼Œæ–°çš„ä¸€è½®å¼€å§‹');
                }
                
                // ç»§ç»­ä¸‹ä¸€ä¸ªç”µè„‘æˆ–ç©å®¶å›åˆ
                if (!game.gameOver) {
                    if (game.players[game.currentPlayerIdx].isHuman) {
                        updateMessage('è½®åˆ°ä½ äº†ï¼');
                    } else {
                        setTimeout(computerPlay, 1000);
                    }
                }
            }
        }
        
        // æ‰§è¡Œå‡ºç‰Œ
        function executePlay(playerIdx, cards) {
            const player = game.players[playerIdx];
            
            // ç§»é™¤å‡ºçš„ç‰Œ
            cards.forEach(card => {
                const index = player.hand.findIndex(c => 
                    c.suit === card.suit && c.rank === card.rank);
                if (index !== -1) {
                    player.hand.splice(index, 1);
                }
            });
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            game.lastPlay = cards;
            game.lastPlayerIdx = playerIdx;
            game.firstTurn = false;
            game.passCount = 0;
            game.selectedCards = [];
            
            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
            if (player.hand.length === 0) {
                game.gameOver = true;
                game.winner = player;
                updateUI();
                showGameOver();
                return;
            }
            
            // è½®åˆ°ä¸‹ä¸€ä¸ªç©å®¶
            game.currentPlayerIdx = (playerIdx + 1) % 3;
            updateUI();
            updateMessage(`${player.name} å‡ºäº† ${cards.map(c => c.suit.symbol + c.rank.name).join(' ')}`);
            
            // å¦‚æœæ˜¯ç”µè„‘å›åˆï¼Œç»§ç»­
            if (!game.gameOver && !game.players[game.currentPlayerIdx].isHuman) {
                setTimeout(computerPlay, 1000);
            } else {
                updateMessage('è½®åˆ°ä½ äº†ï¼');
            }
        }
        
        // æ£€æŸ¥å‡ºç‰Œæ˜¯å¦åˆæ³•
        function isValidPlay(cards, player) {
            if (!cards || cards.length === 0) return false;
            
            // ç¬¬ä¸€æ‰‹å¿…é¡»åŒ…å«æ¢…èŠ±3
            if (game.firstTurn) {
                const hasClubThree = cards.some(c => 
                    c.suit === Suit.CLUB && c.rank === Rank.THREE);
                if (!hasClubThree) return false;
            }
            
            // å¦‚æœæ²¡æœ‰ä¸Šä¸€æ‰‹ç‰Œï¼Œä»»ä½•ç‰Œéƒ½å¯ä»¥å‡º
            if (game.lastPlay.length === 0) return true;
            
            // æ£€æŸ¥ç‰Œå‹æ˜¯å¦ç›¸åŒ
            const currentType = getHandType(cards);
            const lastType = getHandType(game.lastPlay);
            
            if (currentType !== lastType) return false;
            
            // æ£€æŸ¥å¤§å°
            return compareHands(cards, game.lastPlay) > 0;
        }
        
        // è·å–ç‰Œå‹
        function getHandType(cards) {
            if (cards.length === 1) return 'single';
            if (cards.length === 2) {
                if (cards[0].rank === cards[1].rank) return 'pair';
            }
            if (cards.length === 3) {
                if (cards[0].rank === cards[1].rank && cards[1].rank === cards[2].rank) return 'triple';
            }
            return 'invalid';
        }
        
        // æ¯”è¾ƒä¸¤æ‰‹ç‰Œ
        function compareHands(cards1, cards2) {
            if (cards1.length !== cards2.length) return 0;
            
            if (cards1.length === 1) {
                return compareCards(cards1[0], cards2[0]);
            }
            
            if (cards1.length === 2) {
                return cards1[0].rank.value - cards2[0].rank.value;
            }
            
            return 0;
        }
        
        // æ¯”è¾ƒä¸¤å¼ ç‰Œ
        function compareCards(c1, c2) {
            if (c1.rank.value !== c2.rank.value) {
                return c1.rank.value - c2.rank.value;
            }
            return c1.suit.value - c2.suit.value;
        }
        
        // æ›´æ–°æ¶ˆæ¯
        function updateMessage(msg) {
            document.getElementById('message').innerText = msg;
        }
        
        // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
        function checkGameOver() {
            for (let player of game.players) {
                if (player.hand.length === 0) {
                    game.gameOver = true;
                    game.winner = player;
                    showGameOver();
                    break;
                }
            }
        }
        
        // æ˜¾ç¤ºæ¸¸æˆç»“æŸ
        function showGameOver() {
            const gameOverDiv = document.getElementById('gameOverScreen');
            gameOverDiv.style.display = 'block';
            gameOverDiv.innerHTML = `
                <div class="game-over">
                    <div>ğŸ‰ æ¸¸æˆç»“æŸï¼ ğŸ‰</div>
                    <div style="font-size: 1.5em; margin: 20px 0;">${game.winner.name} è·èƒœï¼</div>
                    <button class="new-game-btn" onclick="initGame()">æ–°çš„ä¸€å±€</button>
                </div>
            `;
            
            document.getElementById('playerControls').style.display = 'none';
        }
        
        // å¯åŠ¨æ¸¸æˆ
        window.onload = () => {
            initGame();
        };
    </script>
</body>
</html>
